{{!-- resources/views/blog/index.antlers.html --}}
{{#
  This is the main blog overview page template
  Route: /blog
#}}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12" x-data="blogOverview()">
    <!-- Header -->
    <div class="text-center mb-16">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">From the blog</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Learn how to grow your business with our expert advice.</p>
    </div>

    <!-- Filters -->
    <div class="mb-12">
        <div class="flex flex-wrap justify-center gap-3">
            <button 
                @click="filterByCategory('all')"
                :class="selectedCategory === 'all' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'"
                class="category-badge px-6 py-2 rounded-full border border-gray-200 font-medium transition-all duration-200"
            >
                All Posts
            </button>
            
            <template x-for="category in categories" :key="category.id">
                <button 
                    @click="filterByCategory(category.slug)"
                    :class="selectedCategory === category.slug ? 'text-white' : 'bg-white text-gray-700 hover:bg-gray-50'"
                    :style="selectedCategory === category.slug ? `background-color: ${category.color}` : ''"
                    class="category-badge px-6 py-2 rounded-full border border-gray-200 font-medium transition-all duration-200"
                    x-text="category.title"
                ></button>
            </template>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="mb-12 max-w-md mx-auto">
        <div class="relative">
            <input 
                type="text" 
                x-model="searchQuery"
                @input.debounce.500ms="search()"
                placeholder="Search blog posts..."
                class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            >
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div x-show="loading" class="grid gap-8 md:gap-12">
        <template x-for="i in 3">
            <div class="loading-pulse">
                <div class="flex flex-col md:flex-row gap-8 items-start">
                    <div class="w-full md:w-96 h-64 bg-gray-200 rounded-lg"></div>
                    <div class="flex-1 space-y-4">
                        <div class="h-4 bg-gray-200 rounded w-1/4"></div>
                        <div class="h-8 bg-gray-200 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-200 rounded"></div>
                            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gray-200 rounded-full"></div>
                            <div class="space-y-1">
                                <div class="h-4 bg-gray-200 rounded w-24"></div>
                                <div class="h-3 bg-gray-200 rounded w-32"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Blog Posts -->
    <div x-show="!loading" class="space-y-12">
        <template x-for="(blog, index) in blogs" :key="blog.id">
            <article class="fade-in slide-up" :style="`animation-delay: ${index * 0.1}s`">
                <div class="flex flex-col md:flex-row gap-8 items-start group">
                    <!-- Featured Image -->
                    <div class="w-full md:w-96 flex-shrink-0">
                        <div class="aspect-[4/3] rounded-lg overflow-hidden">
                            <img 
                                :src="blog.featured_image ? blog.featured_image.permalink : '/img/placeholder-blog.jpg'"
                                :alt="blog.title"
                                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                            >
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <!-- Meta Info -->
                        <div class="flex items-center gap-4 mb-3">
                            <time 
                                :datetime="blog.published_at"
                                class="text-sm text-gray-500"
                                x-text="formatDate(blog.published_at)"
                            ></time>
                            
                            <template x-for="category in blog.categories" :key="category.id">
                                <span 
                                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                                    :style="`background-color: ${category.color || '#3B82F6'}20; color: ${category.color || '#3B82F6'}`"
                                    x-text="category.title"
                                ></span>
                            </template>
                        </div>
                        
                        <!-- Title -->
                        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 group-hover:text-blue-600 transition-colors">
                            <a :href="`/blog/${blog.slug}`" x-text="blog.title"></a>
                        </h2>
                        
                        <!-- Excerpt -->
                        <p class="text-gray-700 text-lg leading-relaxed mb-6" x-text="blog.excerpt"></p>
                        
                        <!-- Author -->
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <img 
                                    :src="blog.author_avatar ? blog.author_avatar.permalink : '/img/default-avatar.jpg'"
                                    :alt="blog.author_name"
                                    class="w-12 h-12 rounded-full object-cover"
                                >
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-semibold text-gray-900" x-text="blog.author_name"></p>
                                <p class="text-sm text-gray-500" x-text="blog.author_title"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
        </template>
    </div>

    <!-- Load More Button -->
    <div x-show="!loading && currentPage < totalPages" class="mt-16 text-center">
        <button 
            @click="loadMore()"
            :disabled="loading"
            class="inline-flex items-center px-8 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-50"
        >
            <span x-show="!loading">Load More Posts</span>
            <span x-show="loading" class="flex items-center">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Loading...
            </span>
        </button>
    </div>

    <!-- No Results -->
    <div x-show="!loading && blogs.length === 0" class="text-center py-12">
        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0118 12a8 8 0 10-8 8 7.962 7.962 0 01-5.291-2z"></path>
        </svg>
        <h3 class="mt-2 text-sm font-medium text-gray-900">No blog posts found</h3>
        <p class="mt-1 text-sm text-gray-500">Try adjusting your search or filter to find what you're looking for.</p>
    </div>
</div>

{{!-- resources/views/blog/show.antlers.html --}}
{{#
  Individual blog post template
  Route: /blog/{slug}
#}}

<article class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <header class="mb-12">
        <!-- Breadcrumb -->
        <nav class="mb-8">
            <a href="/blog" class="text-blue-600 hover:text-blue-800 font-medium">‚Üê Back to Blog</a>
        </nav>
        
        <!-- Meta Info -->
        <div class="flex items-center gap-4 mb-6">
            <time datetime="{{ published_at format='Y-m-d' }}" class="text-sm text-gray-500">
                {{ published_at format="M j, Y" }}
            </time>
            
            {{ categories }}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium"
                      style="background-color: {{ color }}20; color: {{ color ?? '#3B82F6' }}">
                    {{ title }}
                </span>
            {{ /categories }}
        </div>
        
        <!-- Title -->
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-6">{{ title }}</h1>
        
        <!-- Excerpt -->
        {{ if excerpt }}
            <p class="text-xl text-gray-600 leading-relaxed mb-8">{{ excerpt }}</p>
        {{ /if }}
        
        <!-- Author -->
        <div class="flex items-center border-t border-b border-gray-200 py-6">
            {{ if author_avatar }}
                <img src="{{ author_avatar:permalink }}" alt="{{ author_name }}" 
                     class="w-16 h-16 rounded-full object-cover">
            {{ else }}
                <div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center">
                    <span class="text-gray-500 font-semibold text-lg">{{ author_name | substr:0:1 }}</span>
                </div>
            {{ /if }}
            <div class="ml-4">
                <p class="font-semibold text-gray-900">{{ author_name }}</p>
                {{ if author_title }}
                    <p class="text-gray-500">{{ author_title }}</p>
                {{ /if }}
            </div>
        </div>
    </header>

    <!-- Featured Image -->
    {{ if featured_image }}
        <div class="mb-12">
            <img src="{{ featured_image:permalink }}" alt="{{ title }}" 
                 class="w-full rounded-lg shadow-lg">
        </div>
    {{ /if }}

    <!-- Content -->
    <div class="prose prose-lg prose-gray max-w-none">
        {{ content }}
    </div>
    
    <!-- Related Posts -->
    <div class="mt-16 pt-12 border-t border-gray-200">
        <h3 class="text-2xl font-bold text-gray-900 mb-8">Related Posts</h3>
        
        <div class="grid md:grid-cols-2 gap-8">
            {{ collection:blog limit="2" :except="id" }}
                <article class="group">
                    <div class="aspect-[16/10] rounded-lg overflow-hidden mb-4">
                        <img src="{{ featured_image:permalink ?? '/img/placeholder-blog.jpg' }}" 
                             alt="{{ title }}"
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                    </div>
                    <div class="flex items-center gap-3 mb-2">
                        <time class="text-sm text-gray-500">{{ published_at format="M j, Y" }}</time>
                        {{ categories limit="1" }}
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                  style="background-color: {{ color ?? '#3B82F6' }}20; color: {{ color ?? '#3B82F6' }}">
                                {{ title }}
                            </span>
                        {{ /categories }}
                    </div>
                    <h4 class="text-xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors mb-3">
                        <a href="{{ url }}">{{ title }}</a>
                    </h4>
                    <p class="text-gray-600 text-sm leading-relaxed">{{ excerpt | truncate:120 }}</p>
                </article>
            {{ /collection:blog }}
        </div>
    </div>
</article>

{{!-- resources/js/site.js - Updated Alpine.js component --}}

// Updated blogOverview Alpine component for actual Statamic integration
Alpine.data('blogOverview', () => ({
    blogs: [],
    categories: [],
    selectedCategory: 'all',
    loading: false,
    currentPage: 1,
    totalPages: 1,
    searchQuery: '',
    
    async init() {
        await this.loadCategories();
        await this.loadBlogs();
    },
    
    async loadBlogs(append = false) {
        this.loading = true;
        
        try {
            let url = `/api/collections/blog?page=${this.currentPage}&limit=10&sort=-published_at`;
            
            if (this.selectedCategory !== 'all') {
                url += `&filter[categories:contains]=${this.selectedCategory}`;
            }
            
            if (this.searchQuery.trim()) {
                url += `&filter[title:contains]=${encodeURIComponent(this.searchQuery)}`;
            }
            
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error('Failed to fetch blogs');
            }
            
            const data = await response.json();
            
            if (append && this.currentPage > 1) {
                this.blogs = [...this.blogs, ...data.data];
            } else {
                this.blogs = data.data;
            }
            
            this.totalPages = data.meta.last_page;
            
        } catch (error) {
            console.error('Error loading blogs:', error);
            
            // Fallback: Try to load from page data if API fails
            if (window.blogData) {
                this.blogs = window.blogData.data || [];
                this.totalPages = window.blogData.meta?.last_page || 1;
            }
        } finally {
            this.loading = false;
        }
    },
    
    async loadCategories() {
        try {
            const response = await fetch('/api/taxonomies/categories/terms');
            
            if (response.ok) {
                const data = await response.json();
                this.categories = data.data;
            }
            
        } catch (error) {
            console.error('Error loading categories:', error);
            
            // Fallback categories if API fails
            this.categories = [
                { id: 1, title: 'Marketing', slug: 'marketing', color: '#3B82F6' },
                { id: 2, title: 'Sales', slug: 'sales', color: '#10B981' },
                { id: 3, title: 'Technology', slug: 'technology', color: '#8B5CF6' },
                { id: 4, title: 'Business', slug: 'business', color: '#F59E0B' }
            ];
        }
    },
    
    filterByCategory(category) {
        this.selectedCategory = category;
        this.currentPage = 1;
        this.loadBlogs();
    },
    
    search() {
        this.currentPage = 1;
        this.loadBlogs();
    },
    
    loadMore() {
        if (this.currentPage < this.totalPages) {
            this.currentPage++;
            this.loadBlogs(true);
        }
    },
    
    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }
}));

{{!-- routes/web.php - Add blog routes --}}

Route::statamic('blog', 'blog/index', [
    'title' => 'Blog',
    'template' => 'blog/index'
]);

{{!-- Create a page template for the blog overview: content/pages/blog.md --}}

---
title: Blog
template: blog/index
---

{{!-- Updated CSS additions for resources/css/site.css --}}

/* Blog-specific styles */
.fade-in { 
    animation: fadeIn 0.4s ease-in-out; 
}

.slide-up { 
    animation: slideUp 0.3s ease-out; 
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { 
        opacity: 0;
        transform: translateY(20px);
    }
    to { 
        opacity: 1;
        transform: translateY(0);
    }
}

.loading-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

.category-badge {
    transition: all 0.2s ease-in-out;
}

.category-badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Enhanced prose styles for blog content */
.prose-custom {
    @apply prose prose-gray max-w-none prose-headings:text-gray-900 prose-p:text-gray-700;
}

.prose-custom h2 {
    @apply text-2xl font-bold mt-8 mb-4 text-gray-900;
}

.prose-custom h3 {
    @apply text-xl font-semibold mt-6 mb-3 text-gray-900;
}

.prose-custom p {
    @apply mb-4 leading-relaxed text-gray-700;
}

.prose-custom a {
    @apply text-blue-600 hover:text-blue-800 transition-colors;
}

.prose-custom ul, .prose-custom ol {
    @apply mb-4 ml-6;
}

.prose-custom li {
    @apply mb-2;
}

.prose-custom blockquote {
    @apply border-l-4 border-blue-500 pl-4 italic text-gray-600 my-6;
}

.prose-custom code {
    @apply bg-gray-100 px-1 py-0.5 rounded text-sm;
}

.prose-custom pre {
    @apply bg-gray-900 text-gray-100 p-4 rounded-lg overflow-x-auto my-6;
}

.prose-custom img {
    @apply rounded-lg shadow-md my-6;
}